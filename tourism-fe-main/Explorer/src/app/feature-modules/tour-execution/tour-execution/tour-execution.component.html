<div class="tour-execution-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading tour execution...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && execution && tour" class="execution-content">
    
    <!-- Header -->
    <div class="execution-header">
      <h1>ğŸ¯ {{ tour.name }}</h1>
      <div class="execution-info">
        <span class="status-badge" [class.started]="execution.status === 'STARTED'">
          {{ execution.status }}
        </span>
        <span class="start-time">Started: {{ execution.startTime | date:'medium' }}</span>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <h3>Tour Progress</h3>
        <span class="progress-percentage">{{ getProgressPercentage() }}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
    </div>

    <!-- Position Info -->
    <div class="position-info">
      <h3>ğŸ“ Your Current Position</h3>
      <div class="position-coordinates" *ngIf="currentPosition">
        <span>Lat: {{ currentPosition.lat | number:'1.4-4' }}</span>
        <span>Lng: {{ currentPosition.lng | number:'1.4-4' }}</span>
      </div>
      <p class="position-note">
        ğŸ”„ Position is automatically checked every 10 seconds
      </p>
    </div>

    <!-- Key Points List -->
    <div class="keypoints-section">
      <h3>ğŸ—ºï¸ Tour Route</h3>
      <div class="keypoints-list">
        <div *ngFor="let keypoint of tour.keyPoints; let i = index" 
             class="keypoint-item"
             [class.completed]="isKeyPointCompleted(keypoint.id)">
          
          <div class="keypoint-marker">
            <span class="keypoint-number">{{ i + 1 }}</span>
            <div class="keypoint-status">
              <span *ngIf="isKeyPointCompleted(keypoint.id)" class="completed-icon">âœ…</span>
              <span *ngIf="!isKeyPointCompleted(keypoint.id)" class="pending-icon">â³</span>
            </div>
          </div>

          <div class="keypoint-content">
            <h4>{{ keypoint.name }}</h4>
            <p class="keypoint-description">{{ keypoint.description }}</p>
            <div class="keypoint-details">
              <span class="coordinate">ğŸ“ {{ keypoint.latitude | number:'1.4-4' }}, {{ keypoint.longitude | number:'1.4-4' }}</span>
              <span *ngIf="keypoint.address" class="address">{{ keypoint.address }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-complete" (click)="completeTour()">
        âœ… Complete Tour
      </button>
      <button class="btn btn-abandon" (click)="abandonTour()">
        ğŸšª Abandon Tour
      </button>
    </div>

    <!-- Position Simulator Link -->
    <div class="simulator-note">
      <p>
        ğŸ’¡ Need to update your position? 
        <a routerLink="/position-simulator" class="simulator-link">
          Open Position Simulator
        </a>
      </p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && (!execution || !tour)" class="error-state">
    <h2>âŒ Tour Execution Not Found</h2>
    <p>Unable to load tour execution details.</p>
    <button class="btn btn-back" routerLink="/home">
      â† Back to Home
    </button>
  </div>
</div>